[TOC]

## 组件（页面）初始化状态

一个组件或者一个页面有一个初始状态，最好是利用组件本身 componentDidMount 钩子来设置这个状态，而不是通过其他组件来设置。当然，我指的是无论什么情况下回到这个页面，这个页面都需要呈现相同的状态。如果你因为在其他页面通过操作而改变了这个页面状态，那你还是需要在其他组件中通过对状态的改变来改变页面。

为什么会思考这个问题？

我的主页面中排序功能是默认以当前得分排序，当我点击其他排序方式过后，store 中的状态随之改变，我从其他页面回到这个页面时，由于我的 UI 依然是得分排序，但实际上的排序是其他排序方式，因为我 store 中的状态没有改变。

![1541303298123](assets/1541303298123.png)

最开始，我是通过当我点击确定提交或者确定修改后回来主页面时改变 store，但这样有一个问题，如果我只是通过向前向后的浏览器操作，并不会改变 store，因此我觉得一个页面的状态初始化，最好还是让组件（页面）本身来修改更好，如果其他组件或页面要改变这个状态，那么也可以改变。



## Link 组件中 onClick 传箭头函数的 this 问题

```jsx
<Link to={`/modify-post`} 
      onClick={(e) => {
      console.log(record.key)
      this.props.changeID(record.key)
      debugger
}}>Edit</Link>
```

这里的 this 指向的是 Link 这个组件，也就是这个类，而不是所在组件，具体原因目前还不清楚，但我的猜想是箭头函数会在 Link 这个组件内执行，而不是在父组件的位置执行，因此会指向 Link。

解决的办法是，不使用 this.props，而是将 this.porps 中的属性结构出来，再传入：

```jsx
const { changeID } = this.props
```



## dispatch 的异步性及一些关于程序的想法

```jsx
  componentDidMount(){
    const id = this.props.match.params.id
    this.props.dispatch(changePostID(id))
    console.log(this.props.post)
  }
```

这是 PostDetail 组件中的 componentDidMount。第三行代码中使用了 dispatch，但是在接下来的 console.log(this.props.post) 中，post 是空，也就是说 dispatch 过后并没有等待 dispatch 执行完毕，而是异步的，所以在接下来的代码中才无法接受到这个参数。可这并不是关键。

关键的问题是，我这里并不需要去 dispatch 来改变其 id，我只需要这个 id 就行了。我需要这个 id 来获取 post，并不需要先存储在 store 中，而为什么出现这个问题，是由于之前在主页面中点击 edit 跳转到编辑页面时，我需要一个 id，但这个 id 是在加载组件之前就要有，我就先存储到了 store 中。但这里是不需要这样操作的。。

